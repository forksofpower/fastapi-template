services:
  web:
    # Use the static image with production configurations baked in
    image: fastapi-postgres-app
    ports:
      - "80:8000"
    # Example production command (using Gunicorn and Uvicorn workers)
    command: gunicorn -w 4 -k uvicorn.workers.UvicornWorker app.main:app --bind 0.0.0.0:8000
    environment:
      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@db:5432/${DB_NAME}
      APP_ENV: production
      # Use Docker secrets or an orchestrator for sensitive production secrets
    restart: always
    depends_on:
      - db
